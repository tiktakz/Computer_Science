### IPv4

네트워크 계층에 대표적인 프로토콜은 IP(Internet Protocol)이다. IP에는 버전 4와 버전 6이 있는데 여기서는 버전 4에 대해서 

공부할 것이다.

네트워크 계층에서의 패킷은 datagram이라고 한다. 헤더부분에는 IP 헤더가 있고 data 부분에는 TCP 세그먼트가 담기게 된다.

IP헤더는 20바이트이고 TCP Segment에서의 TCP헤더 역시 20바이트이다. 즉 하나의 데이터그램을 보낼 때 총 40바이트의 오버헤드가 붙게 된다고 볼 수 있다.

### IPv4 구조

| 버전 | 헤더길이 | 서비스타입 | 데이터그램 길이 |
| --- | --- | --- | --- |
| 16비트 식별자 |  | 플래그 | 13비트 단편화 오프셋 |
| TTL | 상위계층 프로토콜 | 헤더 체크섬 |  |
| 32비트 출발지 IP주소 |  |  |  |
| 32비트 도착지 IP주소 |  |  |  |
| 옵션 |  |  |  |
| 데이터 |  |  |  |

-   식별자, 플래그, 13비트 단편화 오프셋: IP Datagram이 실제 라우터의 MTU보다 큰 경우, 한번에 보내지 못한다. 즉 나눠서 보내야하는데 이를 Fragmentation 이라고 한다. 조각으로 나뉘어져 보내진 Datagram은 도착지에서 재조립 되어야하기 때문에 식별자, 플래그, 오프셋을 통해서 IP 단편화를 재조립한다.
-   TTL(Time to Live) : 데이터그램이 네트워크상에서 무한히 순환하지 않도록 하는 것이다. 라우터를 거칠 때 마다 감소시키며 0이 되면 폐기한다

#### IPv4 특징

-   32비트의 길이를 갖고 있다(4바이트). 약 40억개의 주소를 사용할 수 있다는 것이다.
-   IP는 엄밀하게 말하면 인터페이스이다. 라우터는 여러개의 IP 주소 인터페이스를 갖는 장치라고 볼 수 있다

#### IP주소 할당 방식

IP 주소를 할당하는 방식에는 클래스 방식과 CIDR(Classless InterDomain Routing) 방식이 있다.

클래스 방식은 IP주소의 네트워크를 클래스(A,B,C..)로 나누어서 분류했다.  이 방식의 문제점은 주소를 예약해서 사용하는 방식인데, 사용량에 비해 너무 많은 IP주소를 할당받거나 너무 적은 IP 주소를 할당받는다. 즉 기관이 필요한 만큼을 받지 못하기 때문에 비효율적인 방식이다. 

이에 비해 CIDR는 클래스가 없는 주소 배정 방식이다. 

이 방식은 IP주소를 두 부분으로 나누어서 십진수 형태의 a.b.c.d/x로 나타낸다. 여기서 /x 는 주소의 첫 부분의 비트 수 이다. 

즉 필요로 하는 만큼의 IP주소를 할당받을 수 있다는 것이고 이 방식을 채택하면 포워딩 테이블의 크기도 줄일 수 있다.
